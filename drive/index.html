<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
	<meta name="title" content="NETGEAR">
	<link type="image/vnd.microsoft.icon" rel="icon" href="images/favicon.ico" />
	<link type="image/x-icon" rel="shortcut icon" href="images/favicon.ico" />
<script language="javascript" type="text/javascript" src="language/English.js"></script>
<script language="javascript" type="text/javascript" src="language/RU_flow_en.js"></script>

<script language=javascript type=text/javascript src=/jquery-3.6.1.min.js></script>
<script language=javascript type=text/javascript src=/jquery.base64.min.js></script>
<link href="style/login-styles.css" rel="stylesheet">

</head>
<body>
<form>
<script>
var ts = "892262758";
var page="";
function isValidChar_space(each_char)
{
	if( each_char < 32 || each_char > 127)
		return false;
}

function check_fail()
{
	document.getElementById("failmsg").style.display="";
}

function encode_twice(input, randomLength = 1) {
  const generateRandomString = (length) => {
    const chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ=';
    return Array.from({length}, () => 
      chars[Math.floor(Math.random() * chars.length)]
    ).join('');
  };

  const firstEncode = btoa(input);

  const prefix = generateRandomString(randomLength);
  const suffix = generateRandomString(randomLength);

  const combinedStr = prefix + firstEncode + suffix;

  return btoa(combinedStr);
}


function ajax_post(input,success_cb, error_cb, ts, htm){
        var data = input || {};
        $.ajax({
                url: "/apply.cgi?"+(htm||'')+" timestamp=" + ts,
                type: "POST",
                data: data,
                success: function (output) {
                        console.log('success!');
                        if( typeof success_cb === "function" ) {
                                success_cb(output);
                        }
                },
                error: function (err) {
                        console.log('error!');
                        if( typeof error_cb === "function" ) {
                                error_cb(err);
                        }
                }
        });
}

function checklogin(cf)
{
	ajax_post({"submit_flag": "admin_login","username":cf.username.value, "password":encode_twice(cf.password.value)},
		function(output){
		var result = output;
		if(result == 5)
			top.location.href="unauth.cgi";
		else if(result == 3)
			top.location.href="multi_login.html";
		else
				{
						if(page!="" && page.indexOf("BRS_") != -1)
							location.href=page;
						else
			top.location.href=page!=""?page:"start.htm";
					}
		},
		check_fail,ts,null);
	return false;
}

function detectEnter(type, e)
{
	var keycode, event;
	if (window.event)
	{
		event = window.event;
		keycode = window.event.keyCode;
	}
	else if (e)
	{
		event = e;
		keycode = e.which;
	}
	else
		return true;
	if(type == "num")
	{
		if(keycode==13)
			checklogin(document.forms[0]);
	}
	else
		return false;
}
</script>

<div id="loginWrapper">
	<div class="netgearLogo">
		<a href="http://www.netgear.com/" target="_blank">
			<img class="netgear-logo" src="images/svg/netgear.svg">
		</a>
	</div>
	<div class="usernameWrapper">
		
		<div class="head-text"><script>document.write(bh_username);</script></div>
		
		
		<div class="body-text">
																
			<input class="editBody" type="text" name="username" value="" autocomplete="on" autofocus="autofocus" onkeypress="detectEnter('num',event);">
			
		</div>
		
	</div>
	<div class="passwordWrapper">
		
		
		<div class="head-text"><script>document.write(bh_ddns_passwd);</script></div>
		
		
		<div class="body-text">
																
			<input class="editBody" type="password" name="password" value="" autocomplete="on" onkeypress="detectEnter('num',event);">
			
		</div>
	
	</div>

	<div class="loginButton">
		<div>
			<a onclick="return checklogin(document.forms[0])">
				<script>document.write(bh_login);</script>
			</a>
		</div>
	</div>
	<div  id = "failmsg" class="errorMsg" style="display:none"><script>document.write(bh_login_fail_msg);</script></div>
</div>
</form>
</body>

</html>
